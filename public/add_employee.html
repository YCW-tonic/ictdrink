<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0" charset="UTF-8">
<title>ICT È£≤ÊñôÂ§ñÈ£üË®ÇË≥ºÂñÆ</title>

<style>
	
.center {
  margin-left: auto;
  margin-right: auto;
  
}
      
.button {
  background-color: #008CBA; /* Blue */
  border: none;
  color: white;
  padding: 10px 10px;
  text-align: center;
  text-decoration: none;
  display: inline-block;
  font-size: 16px;
  border-radius: 10px;
}

.button_green {
  background-color: #4CAF50;; /* Green */
  border: none;
  color: white;
  padding: 10px 10px;
  text-align: center;
  text-decoration: none;
  display: inline-block;
  font-size: 16px;
  border-radius: 10px;
}

.button_red {
  background-color: #f44336; /* Red */
  border: none;
  color: white;
  padding: 10px 10px;
  text-align: center;
  text-decoration: none;
  display: inline-block;
  font-size: 16px;
  border-radius: 10px;
}

.td_green {
	background-color: #4CAF50;
	border: none;
    color: white;
    padding: 10px 10px;
    text-align: center;
    text-decoration: none;
	font-size: 16px;
}

.td_grey {
	background-color: grey;
	border: none;
    color: white;
    padding: 10px 10px;
    text-align: center;
    text-decoration: none;
	font-size: 16px;
}

.td_red {
	background-color: #f44336;
	border: none;
    color: white;
    padding: 10px 10px;
    text-align: center;
    text-decoration: none;
	font-size: 16px;
}
      
</style>

<!-- update the version number as needed -->
    <script defer src="/__/firebase/8.2.8/firebase-app.js"></script>
    <!-- include only the Firebase features as you need -->
    <script defer src="/__/firebase/8.2.8/firebase-auth.js"></script>
    <script defer src="/__/firebase/8.2.8/firebase-database.js"></script>
    <script defer src="/__/firebase/8.2.8/firebase-firestore.js"></script>
    <script defer src="/__/firebase/8.2.8/firebase-functions.js"></script>
    <script defer src="/__/firebase/8.2.8/firebase-messaging.js"></script>
    <script defer src="/__/firebase/8.2.8/firebase-storage.js"></script>
    <script defer src="/__/firebase/8.2.8/firebase-analytics.js"></script>
    <script defer src="/__/firebase/8.2.8/firebase-remote-config.js"></script>
    <script defer src="/__/firebase/8.2.8/firebase-performance.js"></script>
    <!-- 
      initialize the SDK after all desired features are loaded, set useEmulator to false
      to avoid connecting the SDK to running emulators.
    -->
    <script defer src="/__/firebase/init.js?useEmulator=true"></script>
    <script type="text/javascript" src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
   
<script type='text/javascript'>
var nameArray=[];
var workNoArray=[];
function load() {
	
	
	document.addEventListener('DOMContentLoaded', function() {
		const loadEl = document.querySelector('#load');
        
		var ref = firebase.database().ref('ictdrink')
		
		ref.on("value", function(snapshot) {
			
			snapshot.forEach(function(childSnapshot) {
  				var childData = childSnapshot.val();
  				var id=childData.id;
  				console.log(childData.employee);
  			    var employee = childData.employee;
  			  	nameArray.push(employee.name);
  			    workNoArray.push(employee.empID);
  			    alert(childData.employee);
			});
		});
	 });
}

function onCancell() {
	window.location = 'index.html';
}

function onConfirm() {
	//plantSelect = document.getElementById("plantSelect");
	employeeName = document.getElementById("employeeName");
	employeeNo = document.getElementById("employeeNo");
	
	//alert("select value = "+plantSelect.value);
	
	if (employeeName.value == "") {
		alert("ÂßìÂêç‰∏çËÉΩÁÇ∫Á©∫!");
		return false;
	}
	
	if (employeeNo.value == "") {
		alert("Â∑•Ëôü‰∏çËÉΩÁÇ∫Á©∫!");
		return false;
	}
	
	loading = document.getElementById("loading");
	loading.display = "block";
	
	
	//alert("Êñ∞ÂêâÂª†");
	key=firebase.database().ref('ictdrink').push({
        employee:{
        	name: employeeName.value,
 			empID: employeeNo.value,
 			itemName : "",
 			pay: "0",
 			quantity: "0",
 			price: "0",
 			balance: "0"
 		}
 	}).key;
	console.log(key);
	
	/*if (plantSelect.value == 1) {
		//alert("ÂÆâÊñ∞Âª†");
		key=firebase.database().ref('magtonic_an_sin').push({
	        employee:{
	        	name: employeeName.value,
	 			empID: employeeNo.value,
	 			visitDate : ""
	 		}
	 	}).key;
		console.log(key);
	} else if (plantSelect.value == 2) {
		//alert("Ë•øÊ∏ØÂª†");
		key=firebase.database().ref('magtonic_si_gang').push({
	        employee:{
	        	name: employeeName.value,
	 			empID: employeeNo.value,
	 			visitDate : ""
	 		}
	 	}).key;
		console.log(key);
	} else {
		//alert("Êñ∞ÂêâÂª†");
		key=firebase.database().ref('magtonic').push({
	        employee:{
	        	name: employeeName.value,
	 			empID: employeeNo.value,
	 			visitDate : ""
	 		}
	 	}).key;
		console.log(key);
	}*/
	
	
		
	setTimeout('reloadIndex()', 3000);
	
	
}

function reloadIndex() {
	window.location = 'index.html';
}

</script>
</head>
<body onload="load()">

<h1 align="center">Êñ∞Â¢û‰∫∫Âì°</h1>
<table class="center" border='1'>

	<!-- tr>
		<td>Âª†ÂçÄ</td>
		<td>
			<select id="plantSelect" style="width:100%;">
				<option value=0>Êñ∞Âêâ</option>
				<option value=1>ÂÆâÊñ∞</option>
				<option value=2>Ë•øÊ∏Ø</option>
			</select>
		</td>
	</tr-->
	<tr><td>Â∑•Ëôü</td><td align="center"><input  name="employeeNo" id="employeeNo" type="text" value=""></td></tr>
	<tr><td>ÂßìÂêç</td><td align="center"><input  name="employeeName" id="employeeName" type="text" value=""></td></tr>
	
	
</table>
<br>

	
	<div align="center"><input type="button" class="button" value="Á¢∫ÂÆö" onClick="onConfirm()">&nbsp;&nbsp;&nbsp;&nbsp;<input type="button" class="button_red" value="ÂèñÊ∂à" onClick="onCancell()"></div>



<div align="center" id="loading" style="display:none">
	<img src='Loading_icon.gif' class="img">
</div>
<hr>
<h1 align="center">Âà™Èô§‰∫∫Âì°</h1>
<script>
    
    
    
	$("#table_of_items tr").remove(); 
    
    
    document.addEventListener('DOMContentLoaded', function() {
    const loadEl = document.querySelector('#load');
        // // üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•
        // // The Firebase SDK is initialized and available here!
        //
        // firebase.auth().onAuthStateChanged(user => { });
        // firebase.database().ref('/path/to/ref').on('value', snapshot => { });
        // firebase.firestore().doc('/foo/bar').get().then(() => { });
        // firebase.functions().httpsCallable('yourFunction')().then(() => { });
        // firebase.messaging().requestPermission().then(() => { });
        // firebase.storage().ref('/path/to/ref').getDownloadURL().then(() => { });
        // firebase.analytics(); // call to activate
        // firebase.analytics().logEvent('tutorial_completed');
        // firebase.performance(); // call to activate
        //
        // // üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•
        
        /*key=firebase.database().ref('magtonic').push({
        employee:{
        	name: 'ÊñΩÂª∫Ëàà',
 			empID: '0133',
 			item : 'black tea',
 			money : '60'
 		}
 		}).key;
		console.log(key);
		*/
		
		
		var ref = firebase.database().ref('ictdrink');
		var ref_img = firebase.database().ref("ictdrink_select/url");
		var ref_gold = firebase.database().ref('ictdrink_money/money');
		var no_image_show = document.getElementById("no_image_show");
		//var total_show = document.getElementById("total_show");
		//var current_total = document.getElementById("current_total");
		//var current_price = document.getElementById("current_price");
		
        var total_gold=0;
		var img_area = document.getElementById("img-area");

        ref_gold.on("value", function(snapshot) {
                const data = snapshot.val();
                total_gold = data;
                console.log("========>" + data)
        });
		ref_img.on('value', (snapshot) => {
			const data = snapshot.val();
			if (data == null) {
				no_image_show.style.display = "block";
				img_area.style.display = "none";
			}
			console.log("data = "+data);
			
			var img = $('<img />').attr({
                  'src': data,
                  'alt': 'image',
                  'title': 'image',
                  'width': '100%'
              }).appendTo('#img-area');
		});
		
		console.log(ref_img);
		
		ref.on("value", function(snapshot) {
			
			var body = document.getElementsByTagName('body')[0];
			var prev_tbl_exist = 0;
			//document.getElementsByTagName('body')[0].innerHTML = '';
	    	  //var tbl = document.getElementById('tbl');
	    	var tbl = document.getElementsByTagName('table')[1];
	    	if (tbl != null) {
	    		//alert("table exist");
	    		body.removeChild(tbl);
	    		
	    	}
	    	
	    	var tbl = document.createElement('table');
    		tbl.setAttribute('class', 'center');
	    	tbl.setAttribute('border', '1');
	    	
	    	//var tbl = document.createElement('table');
    		
	    	//var tbl = document.createElement('table');
    		
	    	var tbdy = document.createElement('tbody');
			
	    	  //tbl.style.width = '100%';
	    	
	    	/*var h_th = document.createElement('th');
	    	h_th.appendChild(document.createTextNode("Êñ∞ÂêâÂª†"));
	    	h_th.style.textAlign = "center";
	    	h_th.colSpan = "5";
	    	tbdy.appendChild(h_th);*/
	    	
	    	var h_tr = document.createElement('tr');
	    	
	    	
	    	
	    	var h_td0 = document.createElement('td');
  	      	h_tr.appendChild(h_td0);
				
			var h_td = document.createElement('td');
			h_td.appendChild(document.createTextNode("ÂßìÂêç"));
			h_td.style.textAlign = "center";
			h_tr.appendChild(h_td);
			
			
  	        
  	        /*var h_td7 = document.createElement('td');
  	      	h_td7.appendChild(document.createTextNode("È§òÈ°ç"));
  	      	h_td7.style.textAlign = "center";
			h_tr.appendChild(h_td7);
  	        
  	        var h_td2 = document.createElement('td');    	        
  	      	h_td2.appendChild(document.createTextNode("Ë®ÇÂñÆÂÖßÂÆπ(ÁîúÂ∫¶„ÄÅÂÜ∞Èáè)"));
  	        h_td2.style.textAlign = "center";
  	      	h_tr.appendChild(h_td2);
  	      	
  	        var h_td4 = document.createElement('td');    	        
	      	h_td4.appendChild(document.createTextNode("Êï∏Èáè"));
	        h_td4.style.textAlign = "center";
	      	h_tr.appendChild(h_td4);
	      	
	      	var h_td5 = document.createElement('td');    	        
	      	h_td5.appendChild(document.createTextNode("ÂñÆÂÉπ"));
	        h_td5.style.textAlign = "center";
	      	h_tr.appendChild(h_td5);
	      	
	      	var h_td6 = document.createElement('td');    	        
	      	h_td6.appendChild(document.createTextNode("Â∞èË®à"));
	        h_td6.style.textAlign = "center";
	      	h_tr.appendChild(h_td6);
  	        
  	       
  	        var h_td3 = document.createElement('td');
  	      	//h_td3.innerHTML = "<td><input type=\"button\" id=\"calendar_trigger_"+i+"\" onClick=\"changeDate("+i+")\" value=\"‰øÆÊîπÊôÇÈñì\"></td>";
  	      	h_tr.appendChild(h_td3);
  	        
  	        tbdy.appendChild(h_tr);
  	        */
	    	  
	    	var i=0;
	    	key_array = [];
	    	name_array = [];
	    	work_no_array = [];
	    	itemName_array = [];
	    	quantity_array = [];
	    	
	    	date_array = [];
	    	
	    	var total_count=0;
	    	var total_price=0;
	    	
            
 			snapshot.forEach(function(childSnapshot) {
 				var k = childSnapshot.key;
  				var childData = childSnapshot.val();
  				var id=childData.id;
  				console.log(k);
  				key_array.push(childSnapshot.key);
  				
  			    console.log(childData.employee);
  			    var employee = childData.employee;
  			  
  			    //total_count += parseInt(employee.quantity, 10);
  			    //total_count = total_count + parseInt(employee.quantity, 10);
  			    if (employee.quantity != null) {
  			    	console.log("count = "+parseInt(employee.quantity, 10));
  			    	total_count += parseInt(employee.quantity, 10);
  			    	
  			    	total_price += parseInt(employee.quantity, 10) *„ÄÄparseInt(employee.price, 10)
  			    }
  			  	
  				//create tr
  				var tr = document.createElement('tr');
  				
  				var td0 = document.createElement('td');
    	        td0.innerHTML = "<td><input type=\"button\" class=\"button_red\" id=\"btn_del_"+i+"\" onClick=\"onDeleteEmployee("+i+")\" value=\"Âà™Èô§\"></td>";
    	        tr.appendChild(td0);
  				
    	        var today = new Date();
    	        var dd = String(today.getDate()).padStart(2, '0');
    	        var mm = String(today.getMonth() + 1).padStart(2, '0'); //January is 0!
    	        var yyyy = today.getFullYear();

    	        today = yyyy + '-' + mm + '-' + dd;
    	        
  				var td1 = document.createElement('td');
  				td1.appendChild(document.createTextNode(employee.name));
  				td1.style.textAlign = "center";
  				
  				//alert("today = "+today+", employee.visitDate = "+employee.visitDate);
  				
  				/*if (today.localeCompare(employee.visitDate) == 0) { //visit today
  					td.setAttribute('class', 'td_green');
  				}*/
  				
    	        tr.appendChild(td1);
    	        
    	        name_array.push(employee.name);
    	        
    	        //var td1 = document.createElement('td');
  				//td1.appendChild(document.createTextNode(employee.empID));
  				//td1.style.textAlign = "center";
    	        //tr.appendChild(td1);
    	        
    	        work_no_array.push(employee.empID);

                /*var td7= document.createElement('td');
                td7.style.textAlign = "center";
                if(employee.quantity*employee.price > employee.balance){
                    td7.innerHTML = "<span id=\"balance_"+i+"\" style='color:red'>&nbsp;"+employee.balance+"&nbsp;</span>";
                }
                else{
                    td7.innerHTML = "<span id=\"balance_"+i+"\">&nbsp;"+employee.balance+"&nbsp;</span>";
                }
                tr.appendChild(td7);


    	        
    	        var td2 = document.createElement('td');    	        
    	        td2.innerHTML = "<b><span id=\"item_span_"+i+"\">&nbsp;"+employee.itemName+"&nbsp;</span><input type=\"text\" id=\"item_edit_"+i+"\" value=\""+employee.itemName+"\" style=\"display:none\"></b>";
    	        
    	        if (employee.itemName.length > 0) {
    	        	if (employee.pay == "1") {
    	        		td2.innerHTML += "<br><select id=\"item_select_pay_"+i+"\" style=\"display:none\"><option value=\"0\">Êú™‰ªòÊ¨æ</option><option value=\"1\" selected>Â∑≤‰ªòÊ¨æ</option></select>";
    	        	} else {
    	        		td2.innerHTML += "<br><select id=\"item_select_pay_"+i+"\" style=\"display:none\"><option value=\"0\">Êú™‰ªòÊ¨æ</option><option value=\"1\">Â∑≤‰ªòÊ¨æ</option></select>";
    	        	}
    	        	
    	        	if (employee.pay == "1") {
        	        	td2.innerHTML += "<b><span id=\"item_span_pay_"+i+"\" style=\"color:green;\">Â∑≤‰ªòÊ¨æ</span></b>";
        	        } else {
        	        	td2.innerHTML += "<b><span id=\"item_span_pay_"+i+"\" style=\"color:red;\">Êú™‰ªòÊ¨æ</span></b>";
        	        }
    	        }
    	        
    	    	        
    	        
    	        td2.style.textAlign = "center";
    	        
    	        tr.appendChild(td2);
    	        
  				itemName_array.push(employee.itemName);
    	        
    	      
  				var td4 = document.createElement('td');
  				//if (employee.itemName.length > 0) {
  					td4.innerHTML = "<b><br><span style=\"display:none\" id=\"item_span_quantity_title_"+i+"\">&nbsp;Êï∏Èáè&nbsp;</span><span id=\"item_span_quantity_"+i+"\">&nbsp;"+employee.quantity+"&nbsp;</span><input type=\"number\" id=\"item_edit_quantity_"+i+"\" value=\""+employee.quantity+"\" style=\"display:none;width:50px\"></b>";
  				//}
  				td4.style.textAlign = "center";
  				tr.appendChild(td4);
  				
  				var td5 = document.createElement('td');
  				//if (employee.itemName.length > 0) {
  					td5.innerHTML = "<b><br><span style=\"display:none\" id=\"item_span_price_title_"+i+"\">&nbsp;ÂñÆÂÉπ&nbsp;</span><span id=\"item_span_price_"+i+"\">&nbsp;"+employee.price+"&nbsp;</span><input type=\"number\" id=\"item_edit_price_"+i+"\" value=\""+employee.price+"\" style=\"display:none;width:50px\"></b>";
  				//}
  				td5.style.textAlign = "center";
  				tr.appendChild(td5);
  				
  				var td6 = document.createElement('td');
  				//if (employee.itemName.length > 0) {
  					td6.innerHTML = "<b><span id=\"item_span_small_"+i+"\">&nbsp;"+employee.quantity*employee.price+"&nbsp;</span></b>";
  				//}
  				td6.style.textAlign = "center";
  				tr.appendChild(td6);
  				
    	       
    	        var td3 = document.createElement('td');
    	        td3.innerHTML = "<td>";
    	        td3.innerHTML += "<input type=\"button\" class=\"button_green\" id=\"update_btn_"+i+"\" onClick=\"updateItem("+i+")\" value=\"‰øÆÊîπ\">"
    	        td3.innerHTML += "<input type=\"button\" class=\"button\" id=\"confirm_btn_"+i+"\" onClick=\"onConfirm("+i+")\" value=\"Á¢∫ÂÆö\" style=\"display:none\">"
    	        td3.innerHTML += "<input type=\"button\" class=\"button_red\" id=\"cancell_btn_"+i+"\" onClick=\"onCancell("+i+")\" value=\"ÂèñÊ∂à\" style=\"display:none\">"
    	        td3.innerHTML += "</td>";
    	        tr.appendChild(td3);
    	        */
    	        
    	        tbdy.appendChild(tr);
    	        
    	        i++;
    	   
    	        
    	        
    	        
	    	    
  				
 			});
	    	
 			//current_total.innerHTML = total_count;
 			//current_price.innerHTML = total_price;
            //current_gold.innerHTML = total_gold;
 			
 			
 			
	    	tbl.appendChild(tbdy);
	    	body.appendChild(tbl);
	    	
	    	var br = document.createElement('br');
	    	body.appendChild(br)
	    	
	    	
		});
		
		
        
        
	});
      
      
    </script>
</body>
</html>